name: Website Monitor (Phase 1)

on:
  schedule:
    - cron: "*/2 * * * *" # every 2 minutes (safe for private repo free tier)
  workflow_dispatch:

jobs:
  monitor:
    runs-on: ubuntu-latest

    steps:
      - name: Check websites and send Discord alert
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          WEBSITES=(
            "https://httpstat.us/500"
            "https://google.com"
          )

          for URL in "${WEBSITES[@]}"; do
            STATUS=$(curl -o /dev/null -s -w "%{http_code}" "$URL" || echo "000")

            if [ "$STATUS" -ne 200 ]; then
              MESSAGE="❌ DOWN: $URL (Status: $STATUS)"
            else
              MESSAGE="✅ UP: $URL (Status: $STATUS)"
            fi

            curl -H "Content-Type: application/json" \
              -X POST \
              -d "{\"content\": \"$MESSAGE\"}" \
              "$DISCORD_WEBHOOK"
          done
